# Импорт/экспорт пользователей: конвертация CSV → XML и обратное обновление person_guid

## Описание

Этот PowerShell-скрипт используется для массовой обработки CSV-файлов пользователей:
- Генерирует XML-файлы (`sysconfig.xml` и `energy.xml`) на основе данных из CSV
- Если в строке отсутствует GUID пользователя (`person_guid`), он автоматически генерируется для этой строки
- Итоговый person_guid записывается обратно в исходный CSV-файл

## Формат исходного CSV

- **Кодировка:**  
  CSV можно сохранять в UTF-8 (с BOM или без) или Windows-1251. Скрипт автоматически определяет кодировку.

- **Разделитель:**  
  Скрипт автоматически определяет разделитель (`;` или `,`).

- **Заголовок и поля:**

| Колонка          | Описание                                                 |
|------------------|----------------------------------------------------------|
| name             | ФИО пользователя (например, Иванов Иван Иванович)        |
| login            | Логин пользователя                                      |
| person_guid      | GUID пользователя (может быть пустым — заполнится скриптом) |
| parent_energy    | GUID родителя для energy.xml                            |
| parent_sysconfig | GUID родителя для sysconfig.xml                         |

**Пример содержимого:**
name;login;person_guid;parent_energy;parent_sysconfig
Буханов Андрей Юрьевич;Bukhanov.Ayu;;f0eb1cfb-7939-46e2-b36a-ba316b109a56;74f289ae-0eb9-4341-8912-8e211f4c01f9
Алексенцев Александр Геннадьевич;Sokolov.Sni;;f0eb1cfb-7939-46e2-b36a-ba316b109a56;74f289ae-0eb9-4341-8912-8e211f4c01f9
Михайлова Анна Сергеевна;Mikhaylova.Ase;;f0eb1cfb-7939-46e2-b36a-ba316b109a56;74f289ae-0eb9-4341-8912-8e211f4c01f9

*Если `person_guid` пуст, он будет автоматически сгенерирован и подставлен скриптом в итоговый CSV.*

---

## Как использовать скрипт

1. Поместите один или несколько CSV-файлов в рабочую папку со скриптом.
2. Запустите скрипт PowerShell (**от имени пользователя с правами записи в директорию!**).
3. Введите GUID домена (adGuid), когда появится запрос.
4. Скрипт создаст для каждого исходного CSV два XML-файла (sysconfig.xml, energy.xml).
5. Если в строках не было указан person_guid, он впишется обратно в CSV автоматически.
6. Итоговый CSV сохранится **в той же кодировке**, что был исходный.

---

## Результаты

- Каждый исходный CSV будет обновлен: теперь в поле `person_guid` у всех строк будет заполнен реальный GUID.
- В каждой папке появятся файлы:
    - `[исходный].sysconfig.xml`
    - `[исходный].energy.xml`

---

## Особенности

- **Кириллица и русские буквы поддерживаются** — скрипт работает с UTF-8 и Windows-1251.
- Если в файле были уже заполнены person_guid, они сохраняются без изменений.
- Скрипт распознаёт разделитель, так что можно использовать как `;`, так и `,`.
- Итоговые XML всегда сохраняются в формате UTF-8.

---

## Требования

- PowerShell 5.1 или выше
- Права на запись файлов в директории CSV

---

## Примечания

- Если CSV выглядит поврежденным после обработки (например, не читается Excel), убедитесь, что у исходного файла не было нестандартных символов и строка заголовка соответствует примеру выше.
- Для максимальной совместимости используйте Notepad++ или VS Code при подготовке CSV.

---
